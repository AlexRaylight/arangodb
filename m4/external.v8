dnl -*- mode: Autoconf; -*-

dnl -----------------------------------------------------------------------------------------
dnl option for V8
dnl -----------------------------------------------------------------------------------------

V8_CPPFLAGS=""
V8_LDFLAGS=""

AC_ARG_WITH(v8,
  AS_HELP_STRING([--with-v8=DIR], [where the v8 library and includes are located]),
  [V8_CPPFLAGS="-I$withval/include"
   V8_LDFLAGS="-L$withval/lib"
   V8="$withval"]
)

AC_ARG_WITH(v8-lib,
  AS_HELP_STRING([--with-v8-lib=DIR], [where the v8 library is located]),
  [V8_LDFLAGS="-L$withval"]
)

TR_STATIC_ENABLE([v8])

dnl -----------------------------------------------------------------------------------------
dnl save flags
dnl -----------------------------------------------------------------------------------------

SAVE_CPPFLAGS="$CPPFLAGS"
CPPFLAGS="$CPPFLAGS $V8_CPPFLAGS"

SAVE_LDFLAGS="$LDFLAGS"
LDFLAGS="$LDFLAGS $V8_LDFLAGS"

dnl -----------------------------------------------------------------------------------------
dnl checks for the V8 library
dnl -----------------------------------------------------------------------------------------

AC_MSG_NOTICE([--------------------------------------------------------------------------------])
AC_MSG_NOTICE([CHECKING FOR NCURSES])
AC_MSG_NOTICE([--------------------------------------------------------------------------------])

AC_LANG(C++)

AC_CHECK_LIB([v8], [main], [V8_LIBS="-lv8"], )

if test "x$V8_CPPFLAGS" != x;  then
  TR_INCLUDE([V8_CPPFLAGS])
fi

dnl -----------------------------------------------------------------------------------------
dnl add substitutions
dnl -----------------------------------------------------------------------------------------

AC_SUBST(V8_CPPFLAGS)
AC_SUBST(V8_LDFLAGS)
AC_SUBST(V8_LIBS)

dnl -----------------------------------------------------------------------------------------
dnl restore flags
dnl -----------------------------------------------------------------------------------------

LDFLAGS="$SAVE_LDFLAGS"
CPPFLAGS="$SAVE_CPPFLAGS"

dnl -----------------------------------------------------------------------------------------
dnl informational output
dnl -----------------------------------------------------------------------------------------

FLAG_INFO="$FLAG_INFO|V8_CPPFLAGS: ${V8_CPPFLAGS}"
FLAG_INFO="$FLAG_INFO|V8_LDFLAGS:  ${V8_LDFLAGS}"
FLAG_INFO="$FLAG_INFO|V8_LIBS:     ${V8_LIBS}"
