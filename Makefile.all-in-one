# -*- mode: Makefile; -*-

################################################################################
## LIBEV
################################################################################

BUILT_SOURCES += @top_srcdir@/3rdParty/libev/.libs/libev.a

@top_srcdir@/3rdParty/libev/.libs/libev.a:
	@echo
	@echo "--------------------------------------------------------------------------------"
	@echo "BUILDING LIBEV"
	@echo "--------------------------------------------------------------------------------"
	@echo

	cd @top_srcdir@/3rdParty/libev && ./configure --disable-shared
	cd @top_srcdir@/3rdParty/libev && make

	@echo
	@echo "--------------------------------------------------------------------------------"
	@echo "BUILD LIBEV FINISHED"
	@echo "--------------------------------------------------------------------------------"
	@echo

################################################################################
## V8
################################################################################

if ENABLE_64BIT
V8_BUILD_VERSION=x64.release
endif

if ENABLE_32BIT
V8_BUILD_VERSION=ia32.release
endif

if ENABLE_DARWIN

V8_BUILT_SOURCES = \
	@top_srcdir@/3rdParty/V8//libv8.a \
else

V8_BUILT_SOURCES = \
	@top_srcdir@/3rdParty/V8/out/$(V8_BUILD_VERSION)/libv8_base.a \
	@top_srcdir@/3rdParty/V8/out/$(V8_BUILD_VERSION)/libv8_nosnapshot.a

endif

BUILT_SOURCES += $(V8_BUILT_SOURCE)

$(V8_BUILT_SOURCE):
	@echo
	@echo "--------------------------------------------------------------------------------"
	@echo "BUILDING V8"
	@echo "--------------------------------------------------------------------------------"
	@echo

if ENABLE_DARWIN
	cd @top_srcdir@/3rdParty/V8 && scons snapshot=off library=static mode=release arch=x64
else
	cd @top_srcdir@/3rdParty/V8 && make library=static snapshot=off $(V8_BUILD_VERSION)
endif

	@echo
	@echo "--------------------------------------------------------------------------------"
	@echo "BUILD V8 FINISHED"
	@echo "--------------------------------------------------------------------------------"
	@echo
