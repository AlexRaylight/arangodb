<html><head><title>ArangoDB Manual</title> <style media="screen" type="text/css" style="display:none">body{background-color:white;font:13px Helvetica,arial,freesans,clean,sans-serif;line-height:1.4;color:#333;}#access{font-size:16px;margin-left:12px;display:block;margin-left:10px;margin-right:10px;background-color:#F3F1EE!important;}#access a{border-right:1px solid #DBDEDF;color:#A49F96;display:block;line-height:38px;padding:0 10px;text-decoration:none;}#navigation ul{text-transform:uppercase;list-style:none;margin:0;}#navigation li{float:left;position:relative;}#container{width:920px;margin:0 auto;}a{color:#4183C4;text-decoration:none;}.contents h2{font-size:24px;border-bottom:1px solid #CCC;color:black;}.contents h1{font-size:33px;border-bottom:1px solid #CCC;color:black;}.clearfix:after{content:".";display:block;clear:both;font-size:0;height:0;visibility:hidden;}/**/ *:first-child+html .clearfix{min-height:0;}/**/ * html .clearfix{height:1%;}</style></head><body><div id="container"><img src="images/logo_arangodb.png" width="397" height="67" alt="ArangoDB"><div id="access" role="navigation"><div id="navigation"><ul id="menu-ahome" class="menu"><li><a href="Home.html">Table of contents</a></li> <li><a href="http://www.arangodb.org">ArangoDB homepage</a></li></ul></div><div class="clearfix"></div></div><div>
<!-- Generated by Doxygen 1.7.3 -->
</div>
<div class="header">
  <div class="headertitle">
<h1>HTTP Interface for Batch Requests </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>Clients normally send individual operations to ArangoDB in individual HTTP requests. This is straightforward and simple, but has the disadvantage that the network overhead can be significant if many small requests are issued in a row.</p>
<p>To mititage this problem, ArangoDB offers a batch request API that clients can use to send multiple operations in one batch to ArangoDB. This method is especially useful when the client has to send many HTTP requests with a small body/payload and the individual request resulsts do not depend on each other.</p>
<p>Clients can use ArangoDB's batch API by issuing a multipart HTTP POST request to the URL <code>/_api/batch</code> handler. The handler will accept the request if the Content-Type is <code>multipart/form-data</code> and a boundary string is specified. ArangoDB will then decompose the batch request into its individual parts using this boundary. This also means that the boundary string itself must not be contained in any of the parts. When ArangoDB has split the multipart request into its individual parts, it will process all parts sequentially as if it were a standalone request. When all parts are processed, ArangoDB will generate a multipart HTTP response that contains one part for each part operation result. For example, if you send a multipart request with 5 parts, ArangoDB will send back a multipart response with 5 parts as well.</p>
<p>The server expects each part message to start with exactly the following literal: <code>Content-Type: application/x-arango-batchpart</code>, followed by two Windows linebreaks (i.e. <code>\r\n\r\n</code>). Any deviation will lead to the part being rejected or incorrectly interpreted. The part request payload, formatted as a regular HTTP request, must follow this literal directly.</p>
<p>Note that the literal <code>Content-Type: application/x-arango-batchpart</code> technically is the header of the MIME part, and the HTTP request (including its headers) is the body part of the MIME part.</p>
<p>An actual part request should start with the HTTP method, the called URL, and the HTTP protocol version as usual, followed by arbitrary HTTP headers. Its body should follow after the usual <code>\r\n\r\n</code> literal. Part requests are therefore regular HTTP requests, only embedded inside a multipart message.</p>
<p>The following example will send a batch with 3 individual document creation operations. The boundary used in this example is <code>XXXsubpartXXX</code>.</p>
<div class="fragment"><pre class="fragment">&gt; curl -X POST --data-binary @- --header "Content-Type: multipart/form-data; boundary=XXXsubpartXXX" http://localhost:8529/_api/batch
--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

POST /_api/document?collection=xyz&amp;createCollection=true HTTP/1.1

{"a":1,"b":2,"c":3}
--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

POST /_api/document?collection=xyz HTTP/1.1

{"a":1,"b":2,"c":3,"d":4}
--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

POST /_api/document?collection=xyz HTTP/1.1

{"a":1,"b":2,"c":3,"d":4,"e":5}
--XXXsubpartXXX--
</pre></div><p>The server will then respond with one multipart message, containing the overall status and the individual results for the part operations. The overall status should be 200 except there was an error while inspecting and processing the multipart message. The overall status therefore does not indicate the success of each part operation, but only indicates whether the multipart message could be handled successfully.</p>
<p>Each part operation will return its own status value. As the part operation results are regular HTTP responses (just included in one multipart response), the part operation status is returned as a HTTP status code. The status codes of the part operations are exactly the same as if you called the individual operations standalone. Each part operation might also return arbitrary HTTP headers and a body/payload:</p>
<div class="fragment"><pre class="fragment">HTTP/1.1 200 OK
connection: Keep-Alive
content-type: multipart/form-data; boundary=XXXsubpartXXX
content-length: 1055

--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

HTTP/1.1 202 Accepted
location: /_api/document/101059/9514299
content-type: application/json; charset=utf-8
etag: "9514299"
content-length: 53

{"error":false,"_id":"101059/9514299","_rev":9514299}
--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

HTTP/1.1 202 Accepted
location: /_api/document/101059/9579835
content-type: application/json; charset=utf-8
etag: "9579835"
content-length: 53

{"error":false,"_id":"101059/9579835","_rev":9579835}
--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

HTTP/1.1 202 Accepted
location: /_api/document/101059/9645371
content-type: application/json; charset=utf-8
etag: "9645371"
content-length: 53

{"error":false,"_id":"101059/9645371","_rev":9645371}
</pre></div><p>In the above example, the server returned an overall status code of 200, and each part response contains its own status value (202 in the example):</p>
<p>When constructing the multipart HTTP response, the server will use the same boundary that the client supplied. If any of the part responses has a status code of 400 or greater, the server will also return an HTTP header <code>x-arango-errors</code> containing the overall number of part requests that produced errors:</p>
<div class="fragment"><pre class="fragment">&gt; curl -X POST --data-binary @- --header "Content-Type: multipart/form-data; boundary=XXXsubpartXXX" http://localhost:8529/_api/batch
--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

POST /_api/document?collection=nonexisting

{"a":1,"b":2,"c":3}
--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

POST /_api/document?collection=xyz

{"a":1,"b":2,"c":3,"d":4}
--XXXsubpartXXX--
</pre></div><p>In this example, the overall response code is 200, but as some of the part request failed (with status code 404), the <code>x-arango-errors</code> header of the overall response is <code>1</code>:</p>
<div class="fragment"><pre class="fragment">HTTP/1.1 200 OK
x-arango-errors: 1
content-type: multipart/form-data; boundary=XXXsubpartXXX
content-length: 711

--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

HTTP/1.1 404 Not Found
content-type: application/json; charset=utf-8
content-length: 111

{"error":true,"code":404,"errorNum":1203,"errorMessage":"collection \/_api\/collection\/nonexisting not found"}
--XXXsubpartXXX
Content-Type: application/x-arango-batchpart

HTTP/1.1 202 Accepted
location: /_api/document/101059/9841979
content-type: application/json; charset=utf-8
etag: "9841979"
content-length: 53

{"error":false,"_id":"101059/9841979","_rev":9841979}
--XXXsubpartXXX--
</pre></div> </div></div>
</div></body></html>
